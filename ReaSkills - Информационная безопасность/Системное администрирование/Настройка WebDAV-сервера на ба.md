# Настройка WebDAV-сервера на базе Apache
WebDAV - расширение протокола HTTP предназначенное для редактирования и управления файлами, размещенными на веб-серверах. К его достоинствам относится работа по стандартным протоколам, что дает возможность работать практически из любого места, где есть доступ в интернет. В настоящее время WebDAV часто используется в качестве сетевой файловой системы предоставляя доступ к удаленным файлам стандартными средствами ОС как будто бы они являлись локальными. В данной статье мы рассмотрим настройку WebDAV на базе популярного веб-сервера Apache.

Прежде всего обозначим некоторые особенности и ограничения. В современных условиях мы не видим смысла использовать WebDAV поверх небезопасного протокола HTTP, разве что в пределах периметра локальной сети. Также не следует использовать Basic-аутентификацию, которая предает пароль по сети в открытом виде, особенно в связке с HTTP, тем более что современные Windows-системы не поддерживают такое сочетание.

Для нормальной работы нам понадобится веб-сервер на базе Apache с настроенным SSL и валидным сертификатом, как настроить такой сервер мы рассказывали в статье: [Настраиваем Apache для работы по HTTPS (SSL) с сертификатами Let's Encrypt](https://interface31.ru/tech_it/2019/10/nastraivaem-apache-dlya-raboty-po-https-ssl-s-sertifikatami-lets-encrypt.html). В дальнейшем мы будем опираться на приведенную там конфигурацию.

Прежде всего определимся с местом хранения, так как WebDAV является расширением веб-сервера, то и данные логично разместить в /var/www, создадим там директорию webdav и назначим ее владельцем веб-сервер:

```text-plain
mkdir /var/www/webdav
chown www-data:www-data /var/www/webdav
```

Затем откроем файл конфигурации виртуального хоста, который будет обслуживать WebDAV, в нашем случае это **/etc/apache2/sites-available/example.com-ssl.conf** и добавим в самый его конец, перед закрывающим тегом **</VirtualHost>** следующие строки:

```text-plain
Alias /webdav /var/www/webdav

<Directory /var/www/webdav>
        DAV On
        AuthType Digest
        AuthName "dav"
        AuthUserFile /etc/davpasswd
        Require valid-user 
</Directory>
```

Директива **Alias** позволяет связать запросы к ресурсу **https://example.com/webdav** с папкой **/var/www/webdav** несмотря на то, что она находится вне корневой директории сайта. Секция **Directory** задает настройки, применяемые к данной директории.

*   **DAV On** - включает WebDAV
*   **AuthType Digest** - задает тип аутентификации. Digest-аутентификация не использует пароли в открытом виде, храня и передавая MD5-хеш.
*   **AuthName "dav"** - имя области аутентификации, можно выбрать на собственное усмотрение
*   **AuthUserFile /etc/davpasswd** - файл с паролями пользователей
*   **Require valid-user** - разрешать доступ только прошедшим аутентификацию пользователям.

Теперь заведем пользователей WebDAV ресурса. Для этого используем утилиту htdigest, первого пользователя заводим командой:

```text-plain
htdigest -c /etc/davpasswd dav ivan
```

Ключ **\-с** указывает на необходимость создать файл паролей, если файл существует, то он будет удален и создан заново. После имени файла паролей указывается область аутентификации, в нашем случае - **dav**, и имя пользователя. После чего ему будет необходимо задать пароль. Второго и следующего пользователя создаем командой:

```text-plain
htdigest /etc/davpasswd dav maria
```

Файл паролей имеет следующую структуру:

```text-plain
ivan:dav:4cd22d3cb72753862alc7310533eb371 
maria:dav:a96fIa2e753cd337d63408324720bb7f
```

Первой частью строки идет имя, затем область аутентификации и затем MD5-хеш пароля. Для удаления пользователя просто удалите относящуюся к нему строку.

После чего подключим необходимые модули Apache:

```text-plain
a2enmod dav
a2enmod dav_fs
a2enmod auth_digest
```

Проверим конфигурацию на ошибки и перезапустим сервер:

```text-plain
apachectl -t
service apache2 restart
```

Для проверки наберите в любом браузере **https://example.com/webdav** и вы должны увидеть форму аутентификации, после которой вы увидите листинг директории.